# Javascript å‡½æ•°ä¸­çš„ this æŒ‡å‘ã€ç®­å¤´å‡½æ•°

## ä¸€ã€JavaScript å‡½æ•°ä¸­çš„ this æŒ‡å‘

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªè®©äººå›°æƒ‘çš„é—®é¢˜ï¼š

å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸‰ç§ä¸åŒçš„æ–¹å¼ï¼Œå¯¹å®ƒè¿›è¡Œè°ƒç”¨ï¼Œå®ƒäº§ç”Ÿäº†ä¸‰ç§ä¸åŒçš„ç»“æžœã€‚

```javascript
function foo() {
  console.log(this)
}

// è°ƒç”¨æ–¹å¼ä¸€
foo()

// è°ƒç”¨æ–¹å¼äºŒ
var obj = {
  name: 'zzt',
  foo
}
obj.foo()

// è°ƒç”¨æ–¹å¼ä¸‰
foo.call('abc')
```

è¿™ä¸ªæ¡ˆä¾‹ï¼Œå¯ä»¥ç»™æˆ‘ä»¬å¯ç¤ºï¼š

- JavaScript å‡½æ•°åœ¨è°ƒç”¨æ—¶ï¼Œä¼šé»˜è®¤ç»™ `this` ç»‘å®šä¸€ä¸ªå€¼ï¼›

### 1.this ç»‘å®šçš„æœºåˆ¶

JavaScript å‡½æ•°ä¸­ï¼Œ`this` ç»‘å®šçš„æœºåˆ¶å¦‚ä¸‹ï¼š

- JavaScript å‡½æ•°ä¸­ `this` ç»‘å®šçš„å€¼ï¼Œä¸Žå‡½æ•°å®šä¹‰çš„ä½ç½®ï¼ˆç¼–å†™çš„ä½ç½®ï¼‰æ²¡æœ‰å…³ç³»ï¼›
- JavaScript å‡½æ•°ä¸­ `this` çš„ç»‘å®šçš„å€¼ï¼Œä¸Žå‡½æ•°çš„è°ƒç”¨æ–¹å¼ï¼Œä»¥åŠè°ƒç”¨çš„ä½ç½®æœ‰å…³ç³»ï¼›
- JavaScript å‡½æ•°ä¸­ `this` æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨ï¼ˆè¿è¡Œï¼‰æ—¶ï¼Œè¢«ç»‘å®šçš„ï¼›

### 2.this ç»‘å®šçš„è§„åˆ™

äº‹å®žä¸Šï¼ŒJavaScript å‡½æ•°ä¸­çš„ `this` æœ‰å››ä¸ªç»‘å®šè§„åˆ™ã€‚

- ç»‘å®šä¸€ï¼šé»˜è®¤ç»‘å®šï¼›
- ç»‘å®šäºŒï¼šéšå¼ç»‘å®šï¼›
- ç»‘å®šä¸‰ï¼šæ˜¾ç¤ºç»‘å®šï¼›
- ç»‘å®šå››ï¼šnew ç»‘å®šï¼›

#### 1.é»˜è®¤ç»‘å®š

å½“ä¸€ä¸ªç‹¬ç«‹å‡½æ•°è°ƒç”¨æ—¶ï¼Œå°±ä¼šåº”ç”¨é»˜è®¤ç»‘å®šçš„è§„åˆ™ã€‚

ç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥ç†è§£æˆå‡½æ•°æ²¡æœ‰è¢«ç»‘å®šåˆ°æŸä¸ªå¯¹è±¡ä¸Šè¿›è¡Œè°ƒç”¨ï¼›

ä»¥ä¸‹ JavaScript å‡½æ•°è°ƒç”¨ï¼Œæ˜¯å¸¸è§çš„åº”ç”¨ this é»˜è®¤ç»‘å®šè§„åˆ™çš„æƒ…å†µï¼š

æ¡ˆä¾‹ä¸€ï¼š

```javascript
function foo() {
  console.log(this) // window å¯¹è±¡
}

foo()
```

æ¡ˆä¾‹äºŒï¼š

```javascript
function test1() {
  console.log(this) // window å¯¹è±¡
  test2()
}

function test2() {
  console.log(this) // window å¯¹è±¡
  test3()
}

function test3() {
  console.log(this) // window å¯¹è±¡
}

test1()
```

æ¡ˆä¾‹ä¸‰ï¼š

```javascript
function foo(func) {
  func()
}

var obj = {
  name: 'zzt',
  bar: function () {
    console.log(this) // window å¯¹è±¡
  }
}

foo(obj.bar)
```

this åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹çš„æŒ‡å‘ï¼Œå†æµè§ˆå™¨çŽ¯å¢ƒä¸­æ˜¯ï¼š`window`ã€‚NodeJs çŽ¯å¢ƒä¸­æ˜¯ï¼š`{}`

> åœ¨ JS ä¸¥æ ¼æ¨¡å¼ï¼ˆstrictï¼‰ä¸‹ï¼Œç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼ˆthis é»˜è®¤ç»‘å®šï¼‰æ—¶ this æŒ‡å‘ `undefined`ï¼Œæ‰€ä»¥åœ¨é»˜è®¤ç»‘å®šçš„æƒ…å†µä¸‹ï¼Œthis è¦æ…Žç”¨ã€‚

#### 2.éšå¼ç»‘å®š

éšå¼ç»‘å®šï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„ this ç»‘å®šæ–¹å¼ï¼Œå®ƒé€šè¿‡æŸä¸ªå¯¹è±¡ï¼Œè¿›è¡Œå‡½æ•°çš„è°ƒç”¨ï¼š

> éšå¼ç»‘å®šæ˜¯ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹ä¹¦ä¸­æå‡ºçš„æ¦‚å¿µ

ä»¥ä¸‹ JavaScript å‡½æ•°è¢«å¯¹è±¡è°ƒç”¨ï¼Œæ˜¯å¸¸è§çš„åº”ç”¨ this éšå¼ç»‘å®šè§„åˆ™çš„æƒ…å†µï¼š

æ¡ˆä¾‹ä¸€ï¼š

```javascript
function foo() {
  console.log(this) // obj
}

var obj = {
  name: 'zzt',
  foo
}

obj.foo()
```

æ¡ˆä¾‹äºŒï¼š

```javascript
function foo() {
  console.log(this) // obj1
}

var obj1 = {
  name: 'obj1',
  foo
}

var obj2 = {
  name: 'obj2',
  obj1
}

obj2.obj1.foo()
```

æ¡ˆä¾‹ä¸‰ï¼Œä¸Žä»¥ä¸Šä¸¤ä¸ªæ¡ˆä¾‹åŒºåˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ç‹¬ç«‹è°ƒç”¨ï¼Œthis ç»‘å®šåº”ç”¨çš„æ˜¯é»˜è®¤ç»‘å®šè§„åˆ™ï¼š

```javascript
function foo() {
  console.log(this) // window
}

var obj1 = {
  name: 'obj1',
  foo
}

var bar = obj1.foo
bar()
```

#### 3,æ˜¾ç¤ºç»‘å®š

éšå¼ç»‘å®šï¼Œæœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼š

- å¿…é¡»åœ¨è°ƒç”¨å‡½æ•°çš„å¯¹è±¡å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªå¯¹å‡½æ•°çš„å¼•ç”¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªå±žæ€§ï¼‰ï¼›
- æ­£æ˜¯é€šè¿‡è¿™ä¸ªå¼•ç”¨ï¼Œé—´æŽ¥çš„å°† this ç»‘å®šåˆ°äº†è¿™ä¸ªå¯¹è±¡ä¸Šï¼›

å¦‚æžœæˆ‘ä»¬ä¸å¸Œæœ›åœ¨å¯¹è±¡å†…éƒ¨ï¼ŒåŒ…å«è¿™ä¸ªå‡½æ•°çš„å¼•ç”¨ï¼ŒåŒæ—¶åˆå¸Œæœ›åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šï¼Œå¯¹å‡½æ•°è¿›è¡Œå¼ºåˆ¶è°ƒç”¨ï¼Œè¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿ

##### 1.callã€apply æ–¹æ³•

äº‹å®žä¸Šï¼ŒJavaScript æ‰€æœ‰çš„å‡½æ•°ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ `call` å’Œ `apply` æ–¹æ³•ï¼Œå®ƒä»¬çš„è¯­æ³•åˆ†åˆ«æ˜¯ï¼š

- [Function.prototype.call()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call) æ–¹æ³•ï¼š`function.call(thisArg, arg1, arg2, ...)`
- [Function.prototype.apply()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply) æ–¹æ³•ï¼š`function.apply(thisArg, [argsArray])`

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›¸åŒçš„ï¼Œè¦æ±‚ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼›

- è¿™ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯è¦æ˜¾ç¤ºç»‘å®šçš„ thisã€‚
- åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œä¼šå°† thisç»‘å®šåˆ°è¿™ä¸ªä¼ å…¥çš„å¯¹è±¡ä¸Šã€‚

åŽé¢çš„å‚æ•°ï¼Œ`apply` æ–¹æ³•ä¸ºæ•°ç»„ï¼Œ`call` æ–¹æ³•ä¸ºå‚æ•°åˆ—è¡¨ï¼›

å› ä¸ºä¸Šé¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ˜Žç¡®çš„ç»‘å®šäº†this æŒ‡å‘çš„å¯¹è±¡ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸º æ˜¾å¼ç»‘å®šã€‚

```javascript
function foo() {
  console.log(this)
  // window
  // {name: 'zzt'}
  // Number å¯¹è±¡ï¼Œå­˜æ”¾ç€ 123
}

foo.call(window)
foo.call({name: 'zzt'})
foo.call(123)
```

```javascript
function foo(name, age, height) {
  console.log('fooå‡½æ•°è¢«è°ƒç”¨:', this)
  console.log('æ‰“å°å‚æ•°:', name, age, height)
}
foo.apply('apply', ['kobe', 30, 1.98])
foo.call('call', 'james', 25, 2.05)
```

> æ˜¾ç¤ºç»‘å®šåŽŸå§‹ç±»åž‹ï¼ˆå¦‚ `abc`, `'123'`)ï¼ŒJavaScript å†…éƒ¨ä¼šè½¬æˆåŒ…è£…ç±»å¯¹åº”çš„å¯¹è±¡ã€‚æ‰€ä»¥å‡½æ•°ä¸­çš„ `this`ï¼Œä¸€èˆ¬éƒ½æŒ‡å‘å¯¹è±¡ã€‚

##### 2.bind æ–¹æ³•

å¦‚æžœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå‡½æ•°ï¼Œæ€»æ˜¯æ˜¾ç¤ºçš„ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œåº”è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿ

- äº‹å®žä¸Šï¼ŒJavaScript æ‰€æœ‰çš„å‡½æ•°ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ `bind` æ–¹æ³•ï¼Œå®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š
- [Function.prototype.bind()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind) æ–¹æ³•ï¼Œ`function.bind(thisArg[, arg1[, arg2[, ...]]])`

bind æ–¹æ³•ï¼Œå®ƒè¿”å›žä¸€ä¸ªæ–°çš„ç»‘å®šå‡½æ•°ï¼ˆbound functionï¼ŒBFï¼‰ï¼›

- è¿™ä¸ªç»‘å®šå‡½æ•°ï¼Œæ˜¯ä¸€ä¸ª exotic function objectï¼ˆæ€ªå¼‚å‡½æ•°å¯¹è±¡ï¼ŒECMAScript 2015 ä¸­çš„æœ¯è¯­ï¼‰
- åœ¨ `bind` æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªè¿”å›žçš„æ–°å‡½æ•°çš„ `this` è¢«æŒ‡å®šä¸º `bind` æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°ï¼Œå°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚

```javascript
function foo(name, age, height, address) {
  console.log('foo:', this)
  console.log('å‚æ•°:', name, age, height, address)
}

const bar = foo.bind(obj, 'kobe', 18, 1.88)

bar('LA') // ä¼ å…¥çš„æ˜¯ç¬¬4ä¸ªå‚æ•°ï¼Œæ‰“å°ç»“æžœï¼škobe, 18, 1.88ï¼ŒLA
```

> applyï¼Œcallï¼Œbind éƒ½ç§°ä¸º**æ–¹æ³•**ï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨ Function.prototype ä¸­ã€‚

##### 3.å†…ç½®å‡½æ•°çš„ç»‘å®šæ€è€ƒ

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸€äº› JavaScript çš„å†…ç½®å‡½æ•°ï¼Œæˆ–è€…ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä¸­çš„å†…ç½®å‡½æ•°ã€‚

- è¿™äº›å†…ç½®å‡½æ•°ï¼Œä¼šè¦æ±‚æˆ‘ä»¬ä¼ å…¥å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼ˆå›žè°ƒå‡½æ•°ï¼‰ï¼›
- æˆ‘ä»¬è‡ªå·±å¹¶ä¸ä¼šæ˜¾ç¤ºçš„è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè€Œä¸” JavaScriptå†…éƒ¨ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹åº“å†…éƒ¨ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œï¼›
- è¿™äº›å‡½æ•°ä¸­çš„ this åˆæ˜¯å¦‚ä½•ç»‘å®šçš„å‘¢ï¼Ÿ

`setTimeout` å†…ç½®å‡½æ•°ã€

```javascript
setTimeout(function () {
  console.log('----', this) // æµè§ˆå™¨ï¼šwindow | Nodeï¼šsetTimeout?
}, 0)
```

æ•°ç»„çš„ `forEach` æ–¹æ³•ã€‚

```javascript
;[1].forEach(function (ele) {
  console.log(ele, '^^^', this) // æµè§ˆå™¨ï¼šwindow | Nodeï¼šglobal
}, thisArg) // å¯æŒ‡å®š this
```

DOM å¯¹è±¡çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆæ¯”å¦‚ div å…ƒç´ å¯¹è±¡çš„ç‚¹å‡»ï¼ˆ`click`ï¼‰äº‹ä»¶ï¼Œå³å¯¹è±¡ä¸Šçš„ `onclick` å‡½æ•°ï¼‰

```javascript
var btnEl = document.querySelector('button')

btnEl.onclick = function () {
  console.log('btnçš„ç‚¹å‡»:', this) // btnEl
}
```

#### 4.new ç»‘å®š

JavaScript ä¸­çš„å‡½æ•°ï¼Œå¯ä»¥å½“åšä¸€ä¸ªç±»çš„æž„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ç»“åˆ `new` å…³é”®å­—æ¥ä½¿ç”¨ã€‚

å½“ä½¿ç”¨ `new` å…³é”®å­—ï¼Œæ¥è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š

1. åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ï¼›
2. è¿™ä¸ªç©ºå¯¹è±¡çš„éšå¼åŽŸåž‹ `__proto__` ä¼šæŒ‡å‘æž„é€ å‡½æ•°çš„æ˜¾ç¤ºåŽŸåž‹ `prototype`ï¼ˆå³æ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ prototype è¿žæŽ¥ï¼›ï¼‰ï¼›
3. è¿™ä¸ªç©ºå¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„ this ä¸Šï¼ˆthis çš„ç»‘å®šåœ¨è¿™ä¸ªæ­¥éª¤å®Œæˆï¼‰ï¼›
4. æ‰§è¡Œæž„é€ å‡½æ•°ä¸­çš„ä»£ç ã€‚
5. å¦‚æžœæž„é€ å‡½æ•°æ²¡æœ‰è¿”å›žå…¶ä»–å¯¹è±¡ï¼Œè¡¨è¾¾å¼ä¼šè¿”å›žè¿™ä¸ªæ–°å¯¹è±¡ï¼›

```javascript
function Person(name) {
  console.log(this) // Person {}
  this.name = name
}

var p = new Person('zzt')
console.log(p) // Person { name: 'zzt' }
```

### 3.this ç»‘å®šè§„åˆ™çš„ä¼˜å…ˆçº§

äº†è§£äº†ä¸Šé¢å››æ¡è§„åˆ™ï¼Œä»¥åŽçš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦åŽ»åˆ¤æ–­å‡½æ•°çš„è°ƒç”¨æ–¹å¼å’Œè°ƒç”¨ä½ç½®ã€‚åº”ç”¨äº†å“ªæ¡è§„åˆ™å³å¯ã€‚

ç„¶è€Œï¼Œå¦‚æžœä¸€ä¸ªå‡½æ•°è°ƒç”¨æ–¹å¼å’Œè°ƒç”¨ä½ç½®ï¼Œåº”ç”¨äº†å¤šæ¡è§„åˆ™ï¼Œä¼˜å…ˆçº§ä»Žä½Žåˆ°é«˜ä¾æ¬¡æ˜¯ï¼š

1. é»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æœ€ä½Ž

   - æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯æœ€ä½Žçš„ï¼Œå› ä¸ºå­˜åœ¨å…¶ä»–è§„åˆ™æ—¶ï¼Œå°±ä¼šé€šè¿‡å…¶ä»–è§„åˆ™çš„æ–¹å¼æ¥ç»‘å®š thisã€‚

2. æ˜¾ç¤ºç»‘å®šä¼˜å…ˆçº§ï¼Œé«˜äºŽéšå¼ç»‘å®šï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç å¯éªŒè¯ã€‚

   ```javascript
   var obj = {
     name: 'zzt',
     eat: function () {
       console.log(this.name, 'eatting') // kobe eating
     }
   }

   obj.eat.call({ name: 'kobe' })
   ```

3. new ç»‘å®šä¼˜å…ˆçº§ï¼Œé«˜äºŽéšå¼ç»‘å®šï¼Œé€šè¿‡iä»¥ä¸‹ä»£ç å¯éªŒè¯ï¼š

   ```javascript
   function Person() {
     this.name = 'zzt'
     this.age = 18
   }

   var obj = {
     name: 'kobe',
     person: Person
   }

   var p = new obj.person()
   console.log(p) // PersonÂ {name: 'zzt', age: 18}
   ```

4. æ˜¾ç¤ºç»‘å®šä¸­ï¼Œ`bind` æ–¹æ³•ä¼˜å…ˆçº§é«˜äºŽ `apply`ï¼Œ`call` æ–¹æ³•ã€‚é€šè¿‡ä»¥ä¸‹ä»£ç å¯éªŒè¯ï¼š

   ```javascript
   function foo() {
     console.log(this)
     // zzt
     // zzt
   }

   var bar = foo.bind({ name: 'zzt' })
   bar.call({ name: 'kobe' })
   bar.apply({ name: 'kobe' })
   ```

5. new ç»‘å®šä¼˜å…ˆçº§é«˜äºŽ bind

   - `new` æ“ä½œç¬¦å’Œ `call`ã€`apply` æ–¹æ³•ï¼Œæ˜¯ä¸å…è®¸åŒæ—¶ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è°çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚
   - `new` æ“ä½œç¬¦å¯ä»¥å’Œ `bind` ä¸€èµ·ä½¿ç”¨ï¼Œ`new` ç»‘å®šä¼˜å…ˆçº§è¦é«˜äºŽ `bind` æ–¹æ³•çš„æ˜¾ç¤ºç»‘å®šï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç å¯éªŒè¯ï¼š

   ```javascript
   function Person() {
     this.name = 'zzt'
     this.age = 18
   }

   var person = Person.bind({ name: 'kobe', age: 35 })

   var p = new person()
   console.log(p) // Person {name: 'zzt', age: 18}
   ```

### 4.this ç»‘å®šè§„åˆ™ä¹‹å¤–

ä¸Šé¢ä»‹ç»çš„è§„åˆ™ï¼Œå·²ç»è¶³ä»¥åº”ä»˜å¹³æ—¶çš„å¼€å‘ï¼Œä½†æ˜¯æ€»æœ‰ä¸€äº›è¯­æ³•ï¼Œè¶…å‡ºäº†æˆ‘ä»¬çš„è§„åˆ™ä¹‹å¤–ã€‚

#### 1.å¿½ç•¥æ˜¾ç¤ºç»‘å®š

ä½¿ç”¨ `apply`ã€`call`ã€`bind` æ–¹æ³•ï¼Œä¼ å…¥ `null`ï¼Œ`undefined` æœ€ä¸º thisArg è¿›è¡Œæ˜¾ç¤ºç»‘å®šã€‚

é‚£ä¹ˆå°†ä¼šä½¿ç”¨é»˜è®¤ç»‘å®šçš„è§„åˆ™ï¼Œå³å½“æˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ã€‚

```javascript
function foo() {
  console.log(this)
}

foo.apply(null)
```

#### 2.é—´æŽ¥å‡½æ•°å¼•ç”¨

åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„é—´æŽ¥å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µï¼Œä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

- èµ‹å€¼ (obj2.foo = obj1.foo) çš„ç»“æžœæ˜¯fooå‡½æ•°ï¼›
- foo å‡½æ•°è¢«ç›´æŽ¥è°ƒç”¨ï¼Œé‚£ä¹ˆåº”ç”¨çš„æ˜¯é»˜è®¤ç»‘å®šçš„è§„åˆ™ã€‚

è¿™æ—¶ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹ä¹¦ä¸­æå‡ºçš„æ¦‚å¿µï¼Œ

```javascript
function foo() {
  console.log(this)
}

var obj1 = {
  name: 'obj1',
  foo
}

var obj2 = {
  name: 'obj2'
}

obj1.foo() // {name: 'obj1', foo: Æ’}

;(obj2.foo = obj1.foo)() // window
```

> åœ¨ JavaScript ä¸­ï¼Œä¸€è¡Œä»£ç å¼€å¤´å¦‚æžœæ˜¯å¤§æ‹¬å· `{` æˆ–è€…ä¸­æ‹¬å· `[` æˆ–è€…å°æ‹¬å· `(`ï¼Œé‚£ä¹ˆä¸Šä¸€è¡Œä»£ç æœ«å°¾è¦åŠ åˆ†å·ã€‚
>
> ```javascript
> var bar = 'abc'
> ;(function foo() {
>   console.log('Hello world')
> })()
> ```

## äºŒã€ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°æ˜¯ ES6 ä¹‹åŽå¢žåŠ çš„ä¸€ç§ç¼–å†™å‡½æ•°çš„æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒæ¯”å‡½æ•°è¡¨è¾¾å¼è¦æ›´åŠ ç®€æ´ï¼Œå®ƒæœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š

- ç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š `this`ã€æ²¡æœ‰ `arguments` å±žæ€§ï¼›
- ç®­å¤´å‡½æ•°ä¸èƒ½ä½œä¸ºæž„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼ˆä¸èƒ½å’Œ `new` æ“ä½œç¬¦ä¸€èµ·æ¥ä½¿ç”¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼›

ç®­å¤´å‡½æ•°å¦‚ä½•ç¼–å†™å‘¢ï¼Ÿ

```javascript
var foo = (name, age) => {
  console.log(name, age)
}
```

- `()`: é‡Œé¢æ˜¯å‡½æ•°çš„å‚æ•°ã€‚
- `{}`: é‡Œé¢æ˜¯å‡½æ•°çš„æ‰§è¡Œä½“ã€‚

### 1.ç®­å¤´å‡½æ•°å†™æ³•ä¼˜åŒ–

ä¼˜åŒ–ä¸€: å¦‚æžœåªæœ‰ä¸€ä¸ªå‚æ•° `()` å¯ä»¥çœç•¥ï¼š

```javascript
var nums = ['abc', 'cba', 'nba']

nums.forEach(item => ())
```

ä¼˜åŒ–äºŒï¼šå¦‚æžœå‡½æ•°æ‰§è¡Œä½“ä¸­ï¼Œåªæœ‰ä¸€è¡Œä»£ç ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥å¤§æ‹¬å·ã€‚

- å¹¶ä¸”è¿™è¡Œä»£ç çš„è¿”å›žå€¼ä¼šä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›žå€¼

```javascript
var nums = [123, 456, 789]

nums.forEach(item => console.log(item))

nums.filter(item => true)
```

ä¼˜åŒ–ä¸‰ï¼šå¦‚æžœå‡½æ•°æ‰§è¡Œä½“åªæœ‰è¿”å›žä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶é‡‡ç”¨çœç•¥å¤§æ‹¬å·çš„å†™æ³•ï¼Œé‚£ä¹ˆéœ€è¦ç»™è¿™ä¸ªå¯¹è±¡åŠ ä¸Š `()`

```javascript
var foo = () => {
  return { name: 'zzt' }
}

// ç­‰åŒäºŽ ðŸ‘‡

var bar = () => ({name: 'zzt'})
```

### 2.ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ this

é¦–å…ˆï¼Œç®­å¤´å‡½æ•°æœ¬èº«ä¸ç»‘å®š `this`

ç®­å¤´å‡½æ•°ä¸­çš„ `this`ï¼ŒæŒ‡å‘çš„æ˜¯å±‚ä½œç”¨åŸŸä¸­çš„ `this`ã€‚

ç®­å¤´å‡½æ•°ä¸ç»‘å®š this çš„å¥½å¤„ï¼Œæ¡ˆä¾‹ç†è§£ï¼š

- è¿™é‡Œä½¿ç”¨ `request` æ–¹æ³•ï¼Œæ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚åˆ°æ•°æ®åŽï¼Œå­˜æ”¾åˆ° `obj.names` ä¸­ã€‚
- æˆ‘ä»¬éœ€è¦æ‹¿åˆ° `obj` å¯¹è±¡ï¼Œè®¾ç½® `data`ï¼›
- ä½†æ˜¯ï¼Œæ ¹æ® `request` å‡½æ•°ä¸­ï¼Œä¼ å…¥çš„ `callbackFn` å‡½æ•°çš„è°ƒç”¨ä½ç½®ï¼Œç›´æŽ¥æ‹¿åˆ°çš„ `this`Â·æ˜¯ `window` å¯¹è±¡ï¼Œ
- æˆ‘ä»¬éœ€è¦åœ¨å¤–å±‚å®šä¹‰ï¼š`var that = this`
- åœ¨ `request` çš„å›žè°ƒå‡½æ•°ä¸­ï¼Œä½¿ç”¨ `that` å°±ä»£è¡¨äº† Â·`obj`Â· å¯¹è±¡

```javascript
// ç½‘ç»œè¯·æ±‚çš„å·¥å…·å‡½æ•°
function request(url, callbackFn) {
  var results = ['abc', 'cba', 'nba']

  callbackFn(results)
}

// å®žé™…æ“ä½œçš„ä½ç½®(ä¸šåŠ¡)
var obj = {
  names: [],
  network: function () {
    // 1.æ—©æœŸçš„æ—¶å€™
    var that = this
    request('/names', function (res) {
      that.names = [].concat(res)
    })

    // 2.ç®­å¤´å‡½æ•°å†™æ³•
    request('/names', res => {
      this.names = [].concat(res)
    })
  }
}

obj.network()

console.log(obj)
```
